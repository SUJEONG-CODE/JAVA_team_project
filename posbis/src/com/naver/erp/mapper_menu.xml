<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!--mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm-->
<!-- mapper 태그 선언 -->
<!--mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm-->
   <!-- namespace 속성값으로 [DAO 인터페이스명]이 오며 -->
   <!-- [DAO 인터페이스] 메소드명과 동일한 id 값을 소유한 태그를 내포하고 있다. -->
<!--mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm-->

<mapper namespace="com.naver.erp.MenuDAO">

<!-- ============================ -->
<!-- 게시판 글 목록 구하는 조건문 설정 -->
<!-- ============================ -->
<sql id="menuWhere">
<!-- sql태그 안에 있는 아이디값을 내 맘대로 해도된다. -->

	<if test="keyword!=null and keyword.length()>0">

		and(
			upper(menu_name) like upper('%${keyword}%')
			or upper(main_category_name) like upper('%${keyword}%')
			or upper(mid_category_name) like upper('%${keyword}%')
			or upper(sub_category_name) like upper('%${keyword}%')
			or upper(menu_price) like upper('%${keyword}%')
			or upper(menu_cost) like upper('%${keyword}%')
		)

       </if>
</sql>

   <!--**************************************************************************-->
   <!-- 게시판 검색하는 select 문을 내포한 select 태그 선언 -->
   <!--**************************************************************************-->
   <select id="getMenuList" parameterType="com.naver.erp.MenuSearchDTO" resultType="java.util.HashMap">
   		select * from (select zzz.*, rownum RNUM from(
   
			select
				m.menu_no						"menu_no"
				, m.menu_name               	"menu_name"
				, c.main_category_name    		"main_category_name"
				, c.mid_category_name	  		"mid_category_name"
				, c.sub_category_name	  		"sub_category_name"
				, m.menu_price            		"menu_price"
				, m.menu_cost             		"menu_cost"
			from menu m, code_menu_category c
			where m.MENU_CATEGORY_CODE  = c.MENU_CATEGORY_CODE
					and m.business_no like '%${changeBusinessNo}%'
			
			<include refid="menuWhere"/>
		) zzz  ) where
		
		<![CDATA[
	        RNUM>=${selectPageNo*rowCntPerPage-rowCntPerPage+1}
	        and RNUM<=${selectPageNo*rowCntPerPage}               
	    ]]>	
   </select>

   <!-- 메뉴 목록 총 개수 구하는  select 태그 선언-->
	<select id="getMenuAllCnt" parameterType="com.naver.erp.MenuSearchDTO" resultType="int">

      select 
         count(*)
         from menu m, code_menu_category c
	where m.MENU_CATEGORY_CODE  = c.MENU_CATEGORY_CODE
		and m.business_no like '%${changeBusinessNo}%'
		<include refid="menuWhere"/>
	</select>
   
	<!-- 메뉴 기본 정보 입력하는 insert 문을 내포한 insert 태그 선언-->
	<insert id="insertMenu" parameterType="com.naver.erp.MenuDTO" >
		
		insert into menu(
					menu_no
					, business_no
					, menu_name
					, menu_price
					, menu_cost
					, menu_category_code
			)values(
					(select nvl(max(menu_no),0)+1 from menu)
					,( select business_no
						from business_info 
						where 1=1 and business_no=#{business_no})
					, #{menu_name}
					, ${menu_price}
					, ${menu_cost}
					, (select menu_category_code from code_menu_category
					        where
					        	main_category_name=#{main_category_name}
					        	and mid_category_name=#{mid_category_name}
					        	and sub_category_name=#{sub_category_name})
   			)
	</insert>
	
	
	<select id='getUserNo' parameterType="String" resultType="int">   
		select u_no from user_info where user_id=#{user_id}
	</select>
   
<!-- ========================================================================================= -->
	
	<select id='getBusinessNoList' parameterType="int" resultType="java.util.HashMap">   
	   select 
	      business_no as "business_no" 
	      , business_name as "business_name"
	      
	   from business_info 
	      where 
	         1=1 
	         and u_no=#{u_no}
	</select>
	

   <!-- 대분류 데이터 가져오기 -->
   
   <select id='getMenuCategory1' resultType="java.util.HashMap">
      select
         distinct main_category_name        as "main_category_name"
       from code_menu_category
      where 1=1
   </select>

   <!-- 중분류 데이터 가져오기 -->
   <select id='getMenuCategory2' resultType="String" parameterType="String"  >
      select   
         distinct mid_category_name      as "mid_category_name"
       from code_menu_category
      where 1=1 and main_category_name=#{main_category_name}
   </select>

   <!-- 소분류 데이터 가져오기 -->
   <select id='getMenuCategory3' resultType="String" parameterType="String"  >
      select   
         distinct sub_category_name      as "sub_category_name"
       from code_menu_category
      where 1=1 and mid_category_name=#{mid_category_name}
   </select>
	
	
	
	
</mapper>